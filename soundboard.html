<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Offline Soundboard</title>
<style>
  body{margin:0;background:#0b0b0b;color:white;font-family:sans-serif;display:flex;flex-direction:column;height:100vh;}
  header{background:#161616;padding:10px 20px;display:flex;justify-content:center;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,0.5);}
  .controls{display:flex;align-items:center;gap:10px;}
  button, select, input[type=range]{background:#222;color:white;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;font-size:16px;transition:background 0.2s;}
  button:hover, select:hover{background:#333;}
  input[type=range]{width:200px;cursor:pointer;}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:20px;padding:20px;flex:1;overflow:auto;justify-items:center;}
  .sound-btn{border-radius:50%;width:100px;height:100px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;text-align:center;transition:transform 0.2s;color:#fff;}
  .sound-btn:hover{transform:scale(1.05);}
  .label{margin-top:8px;font-size:12px;color:#ccc;text-align:center;max-width:100px;word-wrap:break-word;}
  .volume-label{margin-left:10px;font-size:14px;}
</style>
</head>
<body>
<header>
  <div class="controls">
    <button id="pick-master">Pick Master Folder</button>
    <select id="pack-select"></select>
    <button id="stop-all">Stop All</button>
    <label for="volume-boost" class="volume-label">Volume Boost:</label>
    <input id="volume-boost" type="range" min="100" max="1000" value="400">
  </div>
</header>
<div class="grid" id="grid"></div>
<script>
let currentAudio = null;
let masterHandle = null;
let logFileHandle = null;
let packsList = [];
let volumeBoost = 400; // default boost

function isAudioFile(name){return /\.(mp3|wav|ogg|m4a)$/i.test(name);}
function randomColor(){const colors=["#e74c3c","#8e44ad","#3498db","#16a085","#f39c12","#d35400","#2ecc71","#1abc9c","#9b59b6","#c0392b"];return colors[Math.floor(Math.random()*colors.length)];}
async function readLog(){try{const file=await logFileHandle.getFile();const text=await file.text();return JSON.parse(text||'{}');}catch(e){return {};}}
async function writeLog(data){const writable=await logFileHandle.createWritable();await writable.write(JSON.stringify(data));await writable.close();}
async function loadSoundPack(folderHandle){
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  for await (const [name,handle] of folderHandle.entries()){
    if(handle.kind==='file' && isAudioFile(name)){
      const container=document.createElement('div');
      container.style.display='flex';
      container.style.flexDirection='column';
      container.style.alignItems='center';
      const btn=document.createElement('div');
      btn.className='sound-btn';
      btn.style.background=randomColor();
      btn.onclick=async()=>{
        if(currentAudio){currentAudio.pause();currentAudio=null;}
        const file=await handle.getFile();
        const url=URL.createObjectURL(file);
        const audio=new Audio(url);
        // apply volume boost
        audio.volume=Math.min(1, 0.4 * (volumeBoost/100));
        currentAudio=audio;
        audio.play();
      };
      const label=document.createElement('div');
      label.className='label';
      label.textContent=name.replace(/\.[^/.]+$/,'');
      container.appendChild(btn);
      container.appendChild(label);
      grid.appendChild(container);
    }
  }
}
async function listSoundPacks(){const foldersHandle=await masterHandle.getDirectoryHandle('folders');const packs=[];for await (const [name,handle] of foldersHandle.entries()){if(handle.kind==='directory')packs.push({name,handle});}return packs;}
function populateDropdown(clearSelection=false){const select=document.getElementById('pack-select');select.innerHTML='';if(clearSelection){const placeholder=document.createElement('option');placeholder.value="";placeholder.textContent="Select a sound pack";placeholder.disabled=true;placeholder.selected=true;select.appendChild(placeholder);}packsList.forEach(p=>{const opt=document.createElement('option');opt.value=p.name;opt.textContent=p.name;select.appendChild(opt);});}
document.getElementById('pick-master').onclick=async()=>{masterHandle=await window.showDirectoryPicker();logFileHandle=await masterHandle.getFileHandle('log.json',{create:true});packsList=await listSoundPacks();const logData=await readLog();if(!logData.lastOpened){populateDropdown(true);return;}if(confirm(`Previously opened sound pack: "${logData.lastOpened}". Open it again?`)){const foldersHandle=await masterHandle.getDirectoryHandle('folders');const packHandle=await foldersHandle.getDirectoryHandle(logData.lastOpened);loadSoundPack(packHandle);populateDropdown();document.getElementById('pack-select').value=logData.lastOpened;} else {populateDropdown(true);}};
document.getElementById('pack-select').onchange=async(e)=>{if(!masterHandle || !e.target.value)return;const selected=e.target.value;const foldersHandle=await masterHandle.getDirectoryHandle('folders');const packHandle=await foldersHandle.getDirectoryHandle(selected);await writeLog({lastOpened:selected});loadSoundPack(packHandle);};
document.getElementById('stop-all').onclick=()=>{if(currentAudio){currentAudio.pause();currentAudio=null;}};
document.getElementById('volume-boost').oninput=(e)=>{volumeBoost=parseInt(e.target.value,10);};
</script>
</body>
</html>
